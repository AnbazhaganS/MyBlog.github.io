<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Anbazhagan Subramani" />
        <meta name="copyright" content="Anbazhagan Subramani" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Abaqus, Mesh, Python, Abaqus, " />

<meta property="og:title" content="Generating Mesh for Abaqus using Python "/>
<meta property="og:url" content="./blog-1.html" />
<meta property="og:description" content="A brief tutorial on how Finite Element mesh can be created for Abaqus using Python" />
<meta property="og:site_name" content="Abaqus Modeling; Tips and Tricks" />
<meta property="og:article:author" content="Anbazhagan Subramani" />
<meta property="og:article:published_time" content="2016-09-12T13:21:00+08:00" />
<meta property="" content="2016-09-12T00:00:00+08:00" />
<meta name="twitter:title" content="Generating Mesh for Abaqus using Python ">
<meta name="twitter:description" content="A brief tutorial on how Finite Element mesh can be created for Abaqus using Python">

        <title>Generating Mesh for Abaqus using Python  Â· Abaqus Modeling; Tips and Tricks
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="./"><span class=site-name>Abaqus Modeling; Tips and Tricks</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href=".">Home</a></li>
                            <li ><a href="./categories.html">Categories</a></li>
                            <li ><a href="./tags.html">Tags</a></li>
                            <li ><a href="./archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="./search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="./blog-1.html"> Generating Mesh for Abaqus using Python  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>    <span class="c1"># I&#39;m using Python 2.7</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
<div class="section" id="contents">
<h2>Contents</h2>
<ol class="arabic simple">
<li><a class="reference internal" href="#outline">Outline of Mesh creation/Steps involved</a></li>
<li><a class="reference internal" href="#gencoords">Generating coordinates</a></li>
<li><a class="reference internal" href="#nodenmesh">Nodes and Mesh</a><ol class="loweralpha">
<li><a class="reference external" href="firstSet">First set of Nodes and line elements</a></li>
<li><a class="reference external" href="leAlongCylinder">Line elements along cylinder height</a></li>
<li><a class="reference external" href="example">Combining line elements to form Mesh</a></li>
</ol>
</li>
<li><a class="reference internal" href="#writeinabq">Writing Node and Element details in Abaqus format</a></li>
<li><a class="reference internal" href="#output">Output</a></li>
<li><a class="reference internal" href="#comment">Few comments</a></li>
</ol>
</div>
<div class="section" id="outline-of-steps-involved-in-mesh-creation">
<span id="outline"></span><h2>1. Outline of steps involved in mesh creation</h2>
<p>In order to create a mesh, the first thing one would need is the nodal
coordinates; Which represents the position of each node (x, y, z) in
space. Then these nodes combine together to form an element, depending
on the type of element number of nodes which make up the element would
vary. For example line/beam element would only need two nodes to form an
element, whereas a quadratic shell would require 4 and so on.</p>
<p>In this post, I've decided to create the mesh
for a cylindrical shell, which is not a too complex shape but it'll
provide an overview of what are all the steps one would require. Also
<strong>Python 2.7</strong> since <strong>Abaqus CLI</strong> (Command Line Interface) supports it.</p>
</div>
<div class="section" id="generating-coordinates">
<span id="gencoords"></span><h2>2. Generating coordinates</h2>
<p>Assume that the cylinder of radius <span class="math">\(2\pi\)</span> is centered at origin
<span class="math">\((0, 0)\)</span>. The coordinates of the cylinder would be nothing but the
coordinates of a circle with increasing through depth/height
coordinates, i.e., same <span class="math">\(x\)</span> and <span class="math">\(y\)</span> with changing <span class="math">\(z\)</span>
per element. Therefore <span class="math">\(x\)</span> ranges from <span class="math">\(-\pi\)</span> to
<span class="math">\(+\pi\)</span> and <span class="math">\(y\)</span> would be <span class="math">\(\pm\sqrt{r^2 - x^2}\)</span>. Each
<span class="math">\(x\)</span> would have two <span class="math">\(y\)</span> coordinates one on the positive side
and the other on negative.</p>
<div class="highlight"><pre><span></span><span class="c1"># Generate coordinates of circle.</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>    <span class="c1"># x coords</span>
<span class="n">circCoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>           <span class="c1"># temp circle array</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">circ</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>          <span class="c1"># + y coords</span>
<span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">circ</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>         <span class="c1"># - y coords</span>

<span class="c1"># First 100 columns are y1 and next is y2, since the coords has to be continous,</span>
<span class="c1"># x, y for second 100 has to be reversed.</span>
<span class="n">circCoords</span><span class="p">[:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">circCoords</span><span class="p">[</span><span class="mi">100</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">circ</span><span class="p">,</span> <span class="n">circ</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Replace 1st row (x)</span>
<span class="n">circCoords</span><span class="p">[:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">circCoords</span><span class="p">[</span><span class="mi">100</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># replace 2nd row (y)</span>

<span class="c1"># np.savetxt(&quot;circleCoords.dat&quot;, circCoords, fmt=&quot;%0.4f\t%0.4f&quot;)</span>
</pre></div>
<img alt="" class="align-right" src="images/circV3.png" style="width: 300px; height: 300px;" />
</div>
<div class="section" id="nodes-and-mesh">
<span id="nodenmesh"></span><h2>3. Nodes and Mesh</h2>
<div class="section" id="first-set-of-nodes-and-lines">
<span id="firstset"></span><h3>3.1. First set of Nodes and lines</h3>
<div class="line-block">
<div class="line">The above generated coordinates (x, y array) combined together with
one more column for depth/height(z) forms nodes. Add coordinates (x,
y, z) with numbers (1...n) as keys to <tt class="docutils literal">nodalCoordinates</tt> dict for
easier accessing. Before we move on to create the shell elements,
we'll create intermediate line elements (1-D) along the height for
ease of understanding. Few important thing's to note;</div>
</div>
<ol class="arabic simple">
<li>The nodal numbers (keys) has to start from 1 in order for Abaqus to be able to read.</li>
<li>The last node should be connected with the first node in order to complete the circle's line element. So the first line element can be made by combining nodes 1 and 2 <span class="math">\([(-3.14, 0.0, 0.0), (-3.0781, 0.6283, 0.0)]\)</span>. The nodes and line element dictionary would look like,</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">nodalCoords</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.14</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="mi">2</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.0781</span><span class="p">,</span> <span class="mf">0.6283</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]}</span>
<span class="n">lineElementDefs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
</pre></div>
<p>One way of doing the above steps with <a class="reference external" href="http://stackoverflow.com/questions/209840/map-two-lists-into-a-dictionary-in-python">relative ease</a> is by combining arbitary integers (<em>keys</em>) <tt class="docutils literal">range(1, no_of_coordinates)</tt> with coordinates (<em>values</em>) array read with <tt class="docutils literal">np.loadtxt()</tt>. Something like,</p>
<div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;circleCoords.dat&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">lastNode</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">nodes_keys</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lastNode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>    <span class="c1"># 0 is not a valid node number</span>
<span class="n">nodalCoords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nodes_keys</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
</pre></div>
<p>But, dict comprehension should be used with little caution! Even if the
size of <tt class="docutils literal">node_keys</tt>, <tt class="docutils literal">leElems_vals</tt> are different this would
silently trim it.</p>
<div class="highlight"><pre><span></span><span class="n">globalCoords</span><span class="p">,</span> <span class="n">globalLe</span><span class="p">,</span> <span class="n">globalElem</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

<span class="n">lastNode</span> <span class="o">=</span> <span class="n">circCoords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">coords_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">lastNode</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">coords_init</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">circCoords</span>      <span class="c1"># Replace the 1 &amp; 2 columns with x and y</span>

<span class="c1"># Nodes dictionary</span>
<span class="n">nodes_keys</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lastNode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nodalCoords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nodes_keys</span><span class="p">,</span> <span class="n">coords_init</span><span class="p">))</span>

<span class="c1"># Line element dictionary</span>
<span class="n">leElems_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">lastNode</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">leElems_vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">leElems_vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nodes_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">leElems_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lastNode</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">lineElems_i</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nodes_keys</span><span class="p">,</span> <span class="n">leElems_vals</span><span class="p">))</span>

<span class="c1"># Update to the global variables</span>
<span class="n">globalCoords</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nodalCoords</span><span class="p">)</span>     <span class="c1"># Add these nodal to the global coords dict</span>
<span class="n">globalLe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineElems_i</span>
</pre></div>
</div>
<div class="section" id="id1">
<span id="lealongcylinder"></span><h3>3.2 Line elements along cylinder height</h3>
<div class="line-block">
<div class="line">The second set of line elements should be created to form a shell
mesh. In order to do that, a set of nodal coordinates should be
created with some modifications. Those are,</div>
</div>
<ol class="arabic simple">
<li>The depth, i.e., should be changed to the required dimensions.</li>
<li>This set of coordinates should have different nodal numbers from the previous set.
It can be done by simply adding a jump to the number of keys from the last set.
<em>Abaqus/CAE</em> has no issues with this.</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">newNodalCoords</span> <span class="o">=</span> <span class="p">{</span><span class="mi">101</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.14</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="mi">102</span><span class="p">:[</span><span class="o">-</span><span class="mf">3.0781</span><span class="p">,</span> <span class="mf">0.6283</span><span class="p">,</span> <span class="n">depth</span><span class="p">]}</span>
<span class="n">newLineElementDefs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">101</span><span class="p">:[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">]}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">nextLineElem</span><span class="p">(</span><span class="n">nodalCoords</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">initialCoords</span><span class="p">,</span> <span class="n">jump</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="c1"># coordinates for jth line element</span>
    <span class="n">newNN</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nodalCoords</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">jump</span>     <span class="c1"># new node number/key</span>
    <span class="n">lastNode_j</span> <span class="o">=</span> <span class="n">newNN</span> <span class="o">+</span> <span class="n">initialCoords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">newCoords_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">initialCoords</span><span class="p">)</span>
    <span class="n">newCoords_j</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span>
    <span class="n">keys_j</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">newNN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lastNode_j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">nodalCoords_j</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys_j</span><span class="p">,</span> <span class="n">newCoords_j</span><span class="p">))</span>

    <span class="c1"># line elements for jth line mesh.</span>
    <span class="n">leElems_vals_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">newCoords_j</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">leElems_vals_j</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">leElems_vals_j</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys_j</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">keys_j</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">leElems_vals_j</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lastNode_j</span><span class="p">,</span> <span class="n">newNN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">lineElems_j</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys_j</span><span class="p">,</span> <span class="n">leElems_vals_j</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">nodalCoords_j</span><span class="p">,</span> <span class="n">lineElems_j</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>         <span class="c1"># Now we&#39;ll create only one more line element</span>
    <span class="n">jump</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.1</span>
    <span class="n">tmp_nodalCoords</span><span class="p">,</span> <span class="n">tmp_le</span> <span class="o">=</span> <span class="n">nextLineElem</span><span class="p">(</span><span class="n">nodalCoords</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">coords_init</span><span class="p">,</span> <span class="n">jump</span><span class="p">)</span>

    <span class="n">globalCoords</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp_nodalCoords</span><span class="p">)</span>
    <span class="n">globalLe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_le</span>
</pre></div>
</div>
<div class="section" id="id2">
<span id="example"></span><h3>3.3 Combining line elements to form Mesh</h3>
<p>Now we can create rectangular shell mesh using the line elements formed
above by combining two consecutive line elements. Since a line element
is formed between two nodes (node numbers), combining two consecutive line
elements will form a four-noded element (2-D).</p>
<div class="highlight"><pre><span></span><span class="n">elementDefs</span> <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># Global element dictionary</span>

<span class="n">le_i</span> <span class="o">=</span> <span class="n">globalLe</span><span class="p">[</span><span class="n">lineElems</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>    <span class="c1"># Line element dictionary 1</span>
<span class="n">le_j</span> <span class="o">=</span> <span class="n">globalLe</span><span class="p">[</span><span class="n">lineElems</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>    <span class="c1"># Line element dictionary 2</span>

<span class="c1"># Combine the line element nodes</span>
<span class="n">elementDefs</span><span class="p">[</span><span class="n">elemNum_i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">le_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">le_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">le_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">le_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">lineElems</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">globalLe</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">le_i</span> <span class="o">=</span> <span class="n">globalLe</span><span class="p">[</span><span class="n">lineElems</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>       <span class="c1"># line element 1</span>
<span class="n">le_j</span> <span class="o">=</span> <span class="n">globalLe</span><span class="p">[</span><span class="n">lineElems</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>       <span class="c1"># line element 2</span>
<span class="n">le_i_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">le_i</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">le_j_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">le_j</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Form arrays of line elements and their nodal connectivity</span>
<span class="n">tmp_le_iArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">le_i</span><span class="p">[</span><span class="n">key_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">key_i</span> <span class="ow">in</span> <span class="n">le_i_keys</span><span class="p">]</span> <span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">tmp_le_jArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">le_j</span><span class="p">[</span><span class="n">key_j</span><span class="p">]</span> <span class="k">for</span> <span class="n">key_j</span> <span class="ow">in</span> <span class="n">le_j_keys</span><span class="p">]</span> <span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="n">tmpMeshArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tmp_le_iArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">tmpMeshArray</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_le_iArray</span>
<span class="n">tmpMeshArray</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">tmpMeshArray</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_le_jArray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tmp_le_jArray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">elemKeys</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">le_i_keys</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">le_i_keys</span><span class="p">)</span> <span class="o">+</span> <span class="n">tmp_le_iArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">elemSet_i</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">elemKeys</span><span class="p">,</span> <span class="n">tmpMeshArray</span><span class="p">))</span>
<span class="n">globalElem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">elemSet_i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-node-and-element-details-in-abaqus-format">
<span id="writeinabq"></span><h2>4. Writing Node and Element details in Abaqus format</h2>
<p>Now we can put everything together in <em>Abaqus</em> format for visualising
what we've created! Aside from the requisites mentioned above, there
are few more for writing <em>Abaqus</em> input file (<tt class="docutils literal">*.inp</tt>).</p>
<ol class="arabic simple">
<li>Any line that starts with double asterisks (<tt class="docutils literal">**</tt>) are treated as comments and single asterisk as Keywords. Some keywords will have the required parameter(s) and some may not. For example <tt class="docutils literal">*ELEMENT</tt> keyword must have <tt class="docutils literal">TYPE</tt> in order to determine the type of the element.</li>
<li>Nodal coordinates block should start with <tt class="docutils literal">*NODE</tt> keyword, with one node per line as <tt class="docutils literal">&lt;node number&gt;, &lt;x_1&gt;, &lt;x_2&gt;, &lt;x_3&gt;</tt>. These coordinates data can be a mixture of integer, floating point, or alphanumeric values and separated by commas.</li>
<li>Similarly Elements block as <tt class="docutils literal">*ELEMENT, TYPE</tt>, followed by data lines of <tt class="docutils literal">&lt;Element number&gt;, &lt;Nodal connectivity&gt;</tt> separated by commas.</li>
</ol>
<p><em>Function to write comments/headers before each blocks</em></p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="n">commentLine</span><span class="p">,</span> <span class="n">keywordLine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes header on file object</span>

<span class="sd">    outFile, file object: already opened file object to write</span>
<span class="sd">    commentLine, str: string which goes in as comment</span>
<span class="sd">    keywordLine, str: keyword line with parameters (if required)</span>
<span class="sd">    Examples</span>
<span class="sd">    header(testfile, &quot;Nodal Coordinates&quot;, &quot;NODE&quot;)</span>
<span class="sd">    header(testfile, &quot;Elements&quot;, &quot;ELEMENT, TYPE=S4&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">commentLine</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;** </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">commentLine</span><span class="p">))</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">commentLine</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">keywordLine</span><span class="p">))</span>
</pre></div>
<p><em>Functions to write node and elements</em></p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">writeNodeLine</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="n">nodeNumber</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes the nodal coordinates line in Abq format, doesnt return anything</span>

<span class="sd">    outFile, file object: already opened file object to write</span>
<span class="sd">    nodeNumber, int: node number</span>
<span class="sd">    coords, list of float: list of coordinates of current node(&lt;x1&gt;,&lt;x2&gt;,&lt;x3&gt;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">, </span><span class="se">\t</span><span class="si">%0.5f</span><span class="s2">, </span><span class="se">\t</span><span class="si">%0.5f</span><span class="s2">, </span><span class="se">\t</span><span class="si">%0.5f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">nodeNumber</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="c1"># Similarly for Element definition</span>
<span class="k">def</span> <span class="nf">writeElemLine</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="n">elemNumber</span><span class="p">,</span> <span class="n">nodalCnvty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes the Element line in Abq format, doesnt return anything; This is</span>
<span class="sd">    valid only for 4 noded shell elements.</span>

<span class="sd">    outFile, file object: already opened file object to write</span>
<span class="sd">    elemNumber, int: Element number</span>
<span class="sd">    nodalCnvty, list of int: Nodal connectivity of current element (&lt;node1&gt;,</span>
<span class="sd">                            &lt;node2&gt;, &lt;node3&gt;, &lt;node4&gt;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">, </span><span class="se">\t</span><span class="si">%d</span><span class="s2">, </span><span class="se">\t</span><span class="si">%d</span><span class="s2">, </span><span class="se">\t</span><span class="si">%d</span><span class="s2">, </span><span class="se">\t</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">elemNumber</span><span class="p">,</span> \
                <span class="n">nodalCnvty</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodalCnvty</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nodalCnvty</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nodalCnvty</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;testfile.inp&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inp</span><span class="p">:</span>
    <span class="n">header</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="s2">&quot;Nodal Coordinates&quot;</span><span class="p">,</span> <span class="s2">&quot;NODE&quot;</span><span class="p">)</span>    <span class="c1"># Write node header</span>
    <span class="c1"># write nodes</span>
    <span class="k">for</span> <span class="n">node_i</span>  <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">globalCoords</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">writeNodeLine</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">node_i</span><span class="p">,</span> <span class="n">globalCoords</span><span class="p">[</span><span class="n">node_i</span><span class="p">])</span>

    <span class="n">inp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">header</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="s2">&quot;Elements&quot;</span><span class="p">,</span> <span class="s2">&quot;ELEMENT, TYPE=S4&quot;</span><span class="p">)</span>    <span class="c1"># Write Element header</span>
    <span class="k">for</span> <span class="n">elem_i</span>  <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">elemSet_i</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">writeElemLine</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">elem_i</span><span class="p">,</span> <span class="n">elemSet_i</span><span class="p">[</span><span class="n">elem_i</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="id3">
<span id="output"></span><h2>5. Output</h2>
<p>Once the <em>testfile.inp</em> is created, we can import this file into
<em>Abaqus</em>. Start <em>Abaqus</em>, while importing select <em>Abaqus</em> Input File
<tt class="docutils literal"><span class="pre">(*.inp,</span> *.pes)</tt> in File Filter.</p>
<img alt="" src="images/OneElemMesh_both.png" />
</div>
<div class="section" id="few-comments">
<span id="comment"></span><h2>6. Few comments</h2>
<div class="section" id="regarding-coding-style">
<h3>Regarding coding style</h3>
<p>It's considered bad practice when the same lines of code are repeated,
instead it could be done much more efficiently replacing by functions.
For <a class="reference internal" href="#example">example</a>, when the mesh is created from line elements. Also instead of dictionary type for
storing node, line element and element information, we can use numpy
arrays with the first column as keys of nodes/elements.</p>
</div>
<div class="section" id="regarding-mesh">
<h3>Regarding Mesh</h3>
<p>As the object/part gets complicated it would be much harder to do it,
which could be done effectively using <strong>Abaqus/CAE GUI</strong> itself. The
above approach is more intended for applications involving the use
<strong>Abaqus</strong> solver programmatically without modelling the section's every
time. For example, <a class="reference external" href="http://www.becas.dtu.dk/">BECAS</a> uses the
similar approach to model wind turbine cross-sections; In fact, I
learned this from their source code. I would like to extend my thanks
for making it freely accessible to the academic users.</p>
<hr class="docutils" />
<p class="rubric">Foot notes</p>
<ol class="arabic simple">
<li>Refer to <em>Abaqus documentation 6.14, Getting started with Keywords edition</em> for more info.</li>
<li><em>Abaqus 6.14-1</em> uses <em>Python 2.7.3, Numpy 1.6.2</em>. If the system python's version is greater, it's important to keep an eye on compatibility when something is not working as expected.</li>
</ol>
<p>Thanks to Dhivya Sundar for her suggestions and proof reading!!</p>
</div>
</div>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-09-12T13:21:00+08:00">Sep 12, 2016</time>

<h4>Last Updated</h4>
<time datetime="2016-09-12T00:00:00+08:00">Sep 12, 2016</time>

            <h4>Category</h4>
            <a class="category-link" href="./categories.html#abaqus-ref">Abaqus</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#abaqus-ref">Abaqus
                    <span>1</span>
</a></li>
                <li><a href="./tags.html#mesh-ref">Mesh
                    <span>1</span>
</a></li>
                <li><a href="./tags.html#python-ref">Python
                    <span>1</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://sg.linkedin.com/in/subramanianbazhagan" title="My LinkedIn Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-linkedin sidebar-social-links"></i></a>
    <a href="https://github.com/anbazhaganS" title="My GitHub Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="https://www.facebook.com/buckster06" title="My Facebook Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-facebook sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>